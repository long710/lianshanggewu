
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Rick's Entropy Lab - Ultimate Edition</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@400;700&display=swap');

    :root {
      --rick-hair: #aaddff;
      --portal-center: #f0ffcc;
      --portal-mid: #bfff00;
      --portal-edge: #00aa00;
      --space-bg: #0b0c15;
      --hud-border: #00ffcc;
      --hud-bg: rgba(0, 20, 30, 0.85);
      --card-bg: rgba(10, 30, 20, 0.9);
    }

    body {
      margin: 0;
      overflow: hidden;
      background-color: var(--space-bg);
      color: #fff;
      font-family: 'Orbitron', sans-serif;
      user-select: none;
    }

    /* --- 核心容器 --- */
    #viewport {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at center, #1a1b2e 0%, #000 100%);
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* 扫描线特效 */
    .crt-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      background-size: 100% 2px, 3px 100%;
      pointer-events: none;
      z-index: 10;
    }

    /* --- UI 布局层 --- */
    #ui-layer {
      position: absolute;
      z-index: 20;
      width: 90%;
      height: 95%; /* 稍微拉高一点 */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      pointer-events: none;
    }

    /* --- 顶部 HUD --- */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0 20px;
    }

    .title-box {
      background: var(--hud-bg);
      border: 1px solid var(--hud-border);
      padding: 15px 30px;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 0 20px rgba(0, 255, 204, 0.2);
      backdrop-filter: blur(10px);
    }

    h1 {
      margin: 0;
      font-size: 24px;
      color: var(--portal-mid);
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 10px var(--portal-mid);
    }
    .sub-text {
      font-family: 'Roboto Mono', monospace;
      font-size: 12px;
      color: #aaa;
    }

    .status-panel {
      background: var(--hud-bg);
      border: 1px solid var(--hud-border);
      padding: 10px 20px;
      border-radius: 0 0 0 20px;
      text-align: right;
      font-family: 'Roboto Mono', monospace;
      color: var(--rick-hair);
      margin-top: 10px;
    }

    /* --- [NEW] 路线图容器 (仅首页显示) --- */
    #roadmap-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -60%);
      width: 80%;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      pointer-events: auto; /* 允许悬停 */
      transition: opacity 0.5s, transform 0.5s;
    }

    #roadmap-container.hidden {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
      pointer-events: none;
    }

    /* 路线连接线 */
    .roadmap-line {
      position: absolute;
      top: 25px;
      left: 50px;
      right: 50px;
      height: 2px;
      background: rgba(191, 255, 0, 0.3);
      z-index: -1;
    }

    .node-card {
      width: 16%;
      background: var(--card-bg);
      border: 1px solid var(--hud-border);
      padding: 15px 10px;
      border-radius: 10px;
      text-align: center;
      position: relative;
      transition: all 0.3s;
      cursor: help;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }

    .node-card:hover {
      transform: translateY(-10px);
      border-color: var(--portal-mid);
      box-shadow: 0 0 20px var(--portal-mid);
      background: rgba(0, 40, 20, 0.95);
      z-index: 100;
    }

    .node-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 10px;
      background: #000;
      border: 2px solid var(--portal-mid);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: var(--portal-mid);
      box-shadow: 0 0 10px var(--portal-mid);
    }

    .node-title {
      font-size: 14px;
      color: #fff;
      margin-bottom: 5px;
    }

    .node-algo {
      font-family: 'Roboto Mono', monospace;
      font-size: 11px;
      color: #aaa;
    }

    /* 瑞克的小贴士 (Tooltip) */
    .rick-tip {
      position: absolute;
      top: 110%;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      background: var(--portal-mid);
      color: #000;
      padding: 10px;
      border-radius: 8px;
      font-size: 12px;
      font-family: 'Roboto Mono', monospace;
      font-weight: bold;
      opacity: 0;
      visibility: hidden;
      transition: 0.2s;
      pointer-events: none;
      box-shadow: 0 5px 15px #000;
      border: 2px solid #000;
      z-index: 101;
    }

    .rick-tip::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      margin-left: -6px;
      border-width: 6px;
      border-style: solid;
      border-color: transparent transparent #000 transparent;
    }

    .node-card:hover .rick-tip {
      opacity: 1;
      visibility: visible;
      top: 120%;
    }

    /* --- 底部对话框与控制区 --- */
    .bottom-bar {
      display: flex;
      gap: 20px;
      align-items: flex-end;
      pointer-events: auto;
      margin-bottom: 30px;
      padding: 0 40px;
    }

    .dialogue-box {
      flex: 1;
      background: rgba(10, 10, 15, 0.95);
      border: 2px solid #555;
      border-left: 5px solid var(--portal-mid);
      border-radius: 10px;
      padding: 20px;
      display: flex;
      gap: 20px;
      align-items: center;
      min-height: 100px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.8);
      transition: all 0.3s;
    }

    .avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid #fff;
      box-shadow: 0 0 15px var(--portal-mid);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      font-weight: bold;
      color: #000;
    }
    .avatar.rick { background-color: var(--rick-hair); color: #0055aa; }
    .avatar.morty { background-color: #ffffaa; color: #aa8800; }

    .text-content h3 {
      margin: 0 0 5px 0;
      font-size: 16px;
      color: var(--portal-mid);
    }
    .text-content p {
      margin: 0;
      font-family: 'Roboto Mono', monospace;
      font-size: 16px;
      line-height: 1.5;
      color: #eee;
    }

    .control-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 200px;
    }

    .btn {
      background: rgba(0, 20, 0, 0.6);
      border: 2px solid var(--portal-mid);
      color: var(--portal-mid);
      padding: 15px 10px;
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      transition: all 0.2s;
      box-shadow: 0 0 10px rgba(191, 255, 0, 0.2);
      text-align: center;
    }

    .btn:hover {
      background: var(--portal-mid);
      color: #000;
      box-shadow: 0 0 25px var(--portal-mid);
    }

    /* 步骤点 */
    .step-indicator {
      display: flex;
      gap: 5px;
      justify-content: center;
    }
    .step-dot {
      width: 20px;
      height: 4px;
      background: #444;
      transform: skewX(-20deg);
      transition: 0.3s;
    }
    .step-dot.active {
      background: var(--portal-mid);
      box-shadow: 0 0 5px var(--portal-mid);
    }

  </style>
</head>
<body>

<div id="viewport">
  <div class="crt-overlay"></div>
  <canvas id="mainCanvas"></canvas>

  <div id="ui-layer">
    <div class="top-bar">
      <div class="title-box">
        <h1>Protocol: GENESIS-128</h1>
        <div class="sub-text">Dimension C-137 // Secure Line</div>
      </div>
      <div class="status-panel">
        <div id="phase-display">OVERVIEW</div>
        <div id="entropy-meter">SYSTEM: IDLE</div>
      </div>
    </div>

    <div id="roadmap-container">
      <div class="roadmap-line"></div>

      <div class="node-card">
        <div class="node-icon">01</div>
        <div class="node-title">熵 (Entropy)</div>
        <div class="node-algo">Random Bits</div>
        <div class="rick-tip">"一切的起源。128位纯粹的物理混乱。如果这步搞砸了，你全完了。"</div>
      </div>

      <div class="node-card">
        <div class="node-icon">02</div>
        <div class="node-title">助记词</div>
        <div class="node-algo">BIP-39</div>
        <div class="rick-tip">"把那串没人看得懂的二进制变成12个单词。方便人类记忆，也方便被黑客偷走。"</div>
      </div>

      <div class="node-card">
        <div class="node-icon">03</div>
        <div class="node-title">种子 (Seed)</div>
        <div class="node-algo">PBKDF2</div>
        <div class="rick-tip">"这是个搅拌机。把单词加盐搅拌2048次。硬得像我前妻的心。"</div>
      </div>

      <div class="node-card">
        <div class="node-icon">04</div>
        <div class="node-title">私钥</div>
        <div class="node-algo">BIP-32 / 44</div>
        <div class="rick-tip">"从种子衍生出的主钥匙。别把这个给任何人，Morty，别给！"</div>
      </div>

      <div class="node-card">
        <div class="node-icon">05</div>
        <div class="node-title">地址</div>
        <div class="node-algo">Keccak-256</div>
        <div class="rick-tip">"最后一步。把公钥切一切，这就是你的收款账号。"</div>
      </div>
    </div>

    <div class="bottom-bar">
      <div class="dialogue-box">
        <div class="avatar rick" id="avatar">R</div>
        <div class="text-content">
          <h3 id="speaker">RICK</h3>
          <p id="message">Loading...</p>
        </div>
      </div>

      <div class="control-panel">
        <div class="step-indicator" id="step-dots">
          <div class="step-dot active"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
        </div>
        <button class="btn" id="next-btn" onclick="nextPhase()">START SIMULATION</button>
      </div>
    </div>
  </div>
</div>

<script>
  /**
   * CONFIG & STATE
   */
  const canvas = document.getElementById('mainCanvas');
  const ctx = canvas.getContext('2d');

  // UI References
  const ui = {
    avatar: document.getElementById('avatar'),
    speaker: document.getElementById('speaker'),
    message: document.getElementById('message'),
    phaseDisplay: document.getElementById('phase-display'),
    entropyMeter: document.getElementById('entropy-meter'),
    nextBtn: document.getElementById('next-btn'),
    dots: document.querySelectorAll('.step-dot'),
    roadmap: document.getElementById('roadmap-container')
  };

  let width, height;
  let frame = 0;
  let currentPhase = 0; // 0=Roadmap, 1=Chaos, 2=Mixer, 3=Pool, 4=Collapse, 5=Result
  let particles = [];
  let portalRing = [];

  // Data for the story
  const script = [
    {
      phase: "00. THE BLUEPRINT",
      speaker: "RICK",
      avatarClass: "rick",
      text: "听着 Morty，看屏幕中间的全息图。这就是我们要制造的东西。从纯粹的【混乱】到最后的【地址】。鼠标移上去看看，别像个白痴一样盯着。",
      btnText: "START SIMULATION >>"
    },
    {
      phase: "01. PHYSICAL CHAOS",
      speaker: "RICK",
      avatarClass: "rick",
      text: "好，程序启动。第一步是【采集混乱】。计算机正在捕捉热噪声和宇宙辐射。看背景里的那些线条，那不是特效，那是真正的随机性！",
      btnText: "COLLECT CHAOS >>"
    },
    {
      phase: "02. THE MIXER",
      speaker: "MORTY",
      avatarClass: "morty",
      text: "哦天哪 Rick，这太快了。我们现在要怎么处理这些乱七八糟的数据？",
      btnText: "OPEN POOL >>"
    },
    {
      phase: "03. ENTROPY POOL",
      speaker: "RICK",
      avatarClass: "rick",
      text: "我们把它扔进【熵池】！这就像个数学离心机。把所有物理信号搅碎，直到没人能预测下一个比特是什么。看着这绿色的漩涡，Morty，这是加密学的艺术！",
      btnText: "COLLAPSE >>"
    },
    {
      phase: "04. QUANTUM COLLAPSE",
      speaker: "RICK",
      avatarClass: "rick",
      text: "现在最关键的一步：【坍缩】。我们从池子里瞬间抽取 128 位数据。就像在多元宇宙里同时抛了128次硬币。看好了，它们正在变成 0 和 1。",
      btnText: "FINALIZE >>"
    },
    {
      phase: "05. THE SEED",
      speaker: "RICK",
      avatarClass: "rick",
      text: "完成。屏幕上这就是你的【原始熵】。经过 SHA-256 和那些乱七八糟的算法，它就是你的钱包。现在... 给我拿瓶酒来。",
      btnText: "RESET SYSTEM"
    }
  ];

  /**
   * INITIALIZATION
   */
  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }
  window.addEventListener('resize', resize);
  resize();

  function rand(min, max) { return Math.random() * (max - min) + min; }

  // Init Portal Ring
  for(let i=0; i<120; i++) {
    portalRing.push({
      angle: rand(0, Math.PI*2),
      r: rand(150, 350),
      speed: rand(0.01, 0.04),
      size: rand(2, 6)
    });
  }

  /**
   * DRAWING FUNCTIONS
   */

  const stars = Array.from({length: 150}, () => ({
    x: rand(0, 3000), y: rand(0, 2000), z: rand(0.2, 1.5), alpha: rand(0.1, 0.8)
  }));

  function drawBg() {
    // Deep Space
    const grad = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width);
    grad.addColorStop(0, '#121820');
    grad.addColorStop(1, '#000000');
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,width,height);

    // Stars
    ctx.fillStyle = '#fff';
    stars.forEach(s => {
      let px = (s.x - width/2) + (frame * s.z * 0.1) + width/2;
      let py = (s.y - height/2) + height/2;

      // Simple loop
      if(px > width) s.x -= width;

      ctx.globalAlpha = s.alpha * (Math.sin(frame * 0.02 + s.x) * 0.3 + 0.7);
      ctx.beginPath(); ctx.arc(px, py, s.z, 0, Math.PI*2); ctx.fill();
    });
    ctx.globalAlpha = 1;
  }

  function drawChaos() {
    // Add particles
    if(frame % 4 === 0 && particles.length < 120) {
      particles.push({
        x: rand(0, width), y: rand(0, height),
        vx: rand(-4, 4), vy: rand(-4, 4),
        life: 120, color: Math.random()>0.6 ? '#00ffcc' : '#ff0055'
      });
    }

    ctx.lineWidth = 1;
    particles.forEach((p, i) => {
      p.x += p.vx; p.y += p.vy;
      p.life--;

      if(p.x < 0 || p.x > width) p.vx *= -1;
      if(p.y < 0 || p.y > height) p.vy *= -1;

      ctx.fillStyle = p.color;
      ctx.beginPath(); ctx.arc(p.x, p.y, 2.5, 0, Math.PI*2); ctx.fill();

      // Connect
      particles.forEach((p2, j) => {
        if(i!==j) {
          let dx = p.x - p2.x;
          let dy = p.y - p2.y;
          let dist = Math.sqrt(dx*dx + dy*dy);
          if(dist < 80) {
            ctx.strokeStyle = `rgba(0, 255, 204, ${0.4 - dist/200})`;
            ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
          }
        }
      });
    });
    particles = particles.filter(p => p.life > 0);
  }

  function drawPortal(collapse = false) {
    const cx = width/2;
    const cy = height/2;

    // Portal Glow
    const glow = ctx.createRadialGradient(cx, cy, 20, cx, cy, 450);
    glow.addColorStop(0, 'rgba(180, 255, 50, 0.7)');
    glow.addColorStop(0.3, 'rgba(50, 200, 0, 0.3)');
    glow.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.globalCompositeOperation = 'lighter';
    ctx.fillStyle = glow;
    ctx.beginPath(); ctx.arc(cx, cy, 450, 0, Math.PI*2); ctx.fill();
    ctx.globalCompositeOperation = 'source-over';

    // Swirling Particles
    portalRing.forEach(p => {
      p.angle += p.speed;
      if(collapse) {
        p.r = p.r * 0.94; // Fast Collapse
      } else {
        p.r = 250 + Math.sin(frame*0.03 + p.angle * 2)*30; // Pulse
      }

      let x = cx + Math.cos(p.angle) * p.r;
      let y = cy + Math.sin(p.angle) * p.r;

      ctx.fillStyle = '#bfff00';
      ctx.shadowBlur = 10;
      ctx.shadowColor = '#bfff00';
      ctx.beginPath(); ctx.arc(x, y, p.size, 0, Math.PI*2); ctx.fill();
      ctx.shadowBlur = 0;
    });

    // Core
    ctx.fillStyle = '#fff';
    let coreSize = collapse ? 30 : 60 + Math.sin(frame*0.1)*15;
    ctx.beginPath(); ctx.arc(cx, cy, coreSize, 0, Math.PI*2); ctx.fill();
  }

  let bits = [];
  function initBits() {
    bits = [];
    let str = "1101001010110001010010100111101010110101001010101011010100101100";
    // Just a visual representation
    let cols = 16;
    let startX = width/2 - (cols * 30)/2;
    let startY = height/2 - (4 * 40)/2;

    for(let i=0; i<64; i++) {
      bits.push({
        val: Math.random()>0.5?1:0,
        x: startX + (i % cols) * 30,
        y: startY + Math.floor(i / cols) * 40,
        alpha: 0
      });
    }
  }

  function drawResult() {
    drawPortal(true);

    ctx.font = "bold 24px 'Orbitron'";
    ctx.textAlign = "center";

    bits.forEach((b, i) => {
      if(frame - animationStartFrame > i * 1.5) {
        b.alpha = Math.min(b.alpha + 0.1, 1);
      }

      ctx.fillStyle = `rgba(0, 255, 204, ${b.alpha})`;
      ctx.shadowBlur = 10;
      ctx.shadowColor = '#00ffcc';
      ctx.fillText(b.val, b.x, b.y);
      ctx.shadowBlur = 0;
    });

    if(currentPhase === 5) {
      ctx.fillStyle = "#fff";
      ctx.font = "16px 'Roboto Mono'";
      ctx.fillText("Raw Entropy Generated (128-bit)", width/2, height/2 + 120);
    }
  }

  /**
   * LOGIC
   */
  let animationStartFrame = 0;

  function updateUI(idx) {
    const data = script[idx];

    // 1. Text Update
    ui.phaseDisplay.innerText = data.phase;
    ui.speaker.innerText = data.speaker;
    ui.message.innerText = data.text;
    ui.nextBtn.innerText = data.btnText;

    // 2. Avatar
    ui.avatar.className = `avatar ${data.avatarClass}`;
    ui.avatar.innerText = data.speaker[0];
    if(data.avatarClass === 'rick') {
      ui.avatar.style.backgroundColor = 'var(--rick-hair)';
      ui.avatar.style.color = '#0055aa';
    } else {
      ui.avatar.style.backgroundColor = '#ffffaa';
      ui.avatar.style.color = '#aa8800';
    }

    // 3. Roadmap Visibility
    if(idx === 0) {
      ui.roadmap.classList.remove('hidden');
    } else {
      ui.roadmap.classList.add('hidden');
    }

    // 4. Dots
    ui.dots.forEach((d, i) => {
      d.classList.toggle('active', i <= idx);
    });

    // 5. Meter
    const progress = [0, 10, 30, 60, 90, 100];
    ui.entropyMeter.innerText = `PROCESS: ${progress[idx]}%`;
  }

  function nextPhase() {
    currentPhase++;
    if(currentPhase >= script.length) {
      currentPhase = 0; // Loop back
      particles = [];
      portalRing.forEach(p => p.r = rand(150, 350));
    }

    if(currentPhase === 5) {
      initBits();
      animationStartFrame = frame;
    }

    updateUI(currentPhase);
  }

  function loop() {
    ctx.clearRect(0,0,width,height);

    // Always draw stars
    drawBg();

    if(currentPhase === 0) {
      // Roadmap Phase: Just bg, maybe faint portal
      // Canvas is mostly clean for the roadmap HTML to shine
    }
    else if (currentPhase === 1) {
      drawChaos();
    }
    else if (currentPhase === 2) {
      drawChaos();
      drawPortal(false);
    }
    else if (currentPhase === 3) {
      drawPortal(false); // Full Portal
    }
    else if (currentPhase === 4) {
      drawPortal(true); // Collapsing
    }
    else if (currentPhase === 5) {
      drawResult();
    }

    frame++;
    requestAnimationFrame(loop);
  }

  // Start
  updateUI(0);
  loop();

</script>
</body>
</html>

```